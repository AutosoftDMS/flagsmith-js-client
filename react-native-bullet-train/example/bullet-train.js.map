{"version":3,"sources":["webpack://bullet-train/webpack/universalModuleDefinition","webpack://bullet-train/webpack/bootstrap","webpack://bullet-train/./node_modules/bullet-train-rules-engine/lib/index.js","webpack://bullet-train/./bullet-train-core.js","webpack://bullet-train/external \"react-native\"","webpack://bullet-train/./index.react-native.js"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__2__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","e","u","default","Array","isArray","split","length","slice","y","all","rules","then","result","Promise","v","b","_","E","map","any","concat","none","includes","O","operator","RegExp","test","console","error","_bulletTrainRulesEngine","fetch","AsyncStorage","BULLET_TRAIN_KEY","BulletTrain","props","_this","this","_classCallCheck","getJSON","url","method","body","environmentID","options","headers","x-environment-key","res","json","getFlags","onChange","onError","identity","api","disableCache","handleResponse","_ref","segments","features","flags","traits","userTraits","userSegments","forEach","feature","toLowerCase","replace","enabled","feature_state_value","trait","trait_key","trait_value","oldFlags","_extends","JSON","parse","segment","_bulletTrainRulesEngine2","setItem","stringify","isFromServer","resolve","catch","_ref2","message","_ref3","getValue","flag","getTrait","getSegments","setTrait","encodeURIComponent","hasFeature","_createClass","_ref4","_this2","_ref4$api","undefined","defaultFlags","interval","assign","initialised","getItem","err","userId","ticks","arguments","setInterval","clearInterval","_ref5","_reactNative","bt"],"mappings":"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","file":"bullet-train.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"react-native\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"react-native\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"bullet-train\"] = factory(require(\"react-native\"));\n\telse\n\t\troot[\"bullet-train\"] = factory(root[\"react-native\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__2__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","!function(e,n){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=n():\"function\"==typeof define&&define.amd?define([],n):\"object\"==typeof exports?exports[\"bullet-train-rules-engine\"]=n():e[\"bullet-train-rules-engine\"]=n()}(window,function(){return function(e){var n={};function r(t){if(n[t])return n[t].exports;var u=n[t]={i:t,l:!1,exports:{}};return e[t].call(u.exports,u,u.exports,r),u.l=!0,u.exports}return r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&\"object\"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,\"default\",{enumerable:!0,value:e}),2&n&&\"string\"!=typeof e)for(var u in e)r.d(t,u,function(n){return e[n]}.bind(null,u));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,\"a\",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p=\"\",r(r.s=1)}([function(e,n,r){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0}),n.default=function e(n,r,t){r=Array.isArray(r)?r:r.split(\".\");n=n[r[0]];if(n&&r.length>1)return e(n,r.slice(1));return void 0===n?t:n}},function(e,n,r){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0}),n.default=function(e,n){return y(e,{all:{rules:n}},[\"all\"]).then(function(e){return{result:e.all.result,rules:e.all.rules}})};var t=function(e){return e&&e.__esModule?e:{default:e}}(r(0));var u=function(e){0},o=\"EQUAL\",l=\"NOT_EQUAL\",a=\"GREATER_THAN\",c=\"GREATER_THAN_INCLUSIVE\",i=\"LESS_THAN\",f=\"LESS_THAN_INCLUSIVE\",s=\"CONTAINS\",d=\"NOT_CONTAINS\",p=\"REGEX\",y=function e(n,r,y){return u(0),new Promise(function(v,b){var _=y[y.length-1],E=(0,t.default)(r,y);if(\"all\"===_||\"any\"===_||\"none\"===_)return Promise.all(E.rules.map(function(t,u){var o=[\"rules\",u];return t.any?o=o.concat([\"any\"]):t.all?o=o.concat([\"all\"]):t.none&&(o=o.concat([\"none\"])),e(n,r,y.concat(o))})).then(function(e){var n=void 0;return\"all\"===_?n=!e.includes(!1):\"any\"===_?n=e.includes(!0):\"none\"===_&&(n=!e.includes(!0)),E.result=!!n,1===y.length&&v(r),v(n)});var O=!!function(e,n){var r=n.property,y=n.operator,v=n.value;u();var b=(0,t.default)(e,r);switch(y){case o:return b===v;case l:return b!==v;case a:return b>v;case c:return b>=v;case i:return b<v;case f:return b<=v;case s:return b&&(b+\"\").includes(v);case d:return!b||!(b+\"\").includes(v);case p:return b&&new RegExp(v).test(b);default:return console.error(\"Invalid operator\"),!1}}(n,E);return E.result=O,v(O)})}}])});\n//# sourceMappingURL=index.js.map","import engine from 'bullet-train-rules-engine';\n\nlet fetch;\nlet AsyncStorage;\nconst BULLET_TRAIN_KEY = \"BULLET_TRAIN_DB\";\n\nconst BulletTrain = class {\n\n    constructor(props) {\n        fetch = props.fetch;\n        AsyncStorage = props.AsyncStorage;\n    }\n\n    getJSON = (url, method, body) => {\n        const { environmentID } = this;\n        const options = {\n            method: method || 'GET',\n            body,\n            headers: {\n                'x-environment-key': environmentID\n            }\n        };\n        if (method !== \"GET\")\n            options.headers['Content-Type'] = 'application/json; charset=utf-8'\n\n        return fetch(url + '?format=json', options)\n            .then(res => res.json());\n    };\n\n    getFlags = () => {\n        const { onChange, onError, identity, api, disableCache } = this;\n\n        const handleResponse = ({ flags: features, traits }, segments) => {\n            // Handle server response\n            let flags = {};\n            let userTraits = {};\n            let userSegments = {};\n            features = features||[];\n            traits = traits||[];\n            features.forEach(feature => {\n                flags[feature.feature.name.toLowerCase().replace(/ /g, '_')] = {\n                    enabled: feature.enabled,\n                    value: feature.feature_state_value\n                };\n            });\n            traits.forEach(trait => {\n                userTraits[trait.trait_key.toLowerCase().replace(/ /g, '_')] = trait.trait_value\n            });\n            this.oldFlags = flags;\n            this.flags = flags;\n            this.traits = userTraits;\n            if (segments) {\n                if (!this.segments) {\n                    segments = segments.map((s)=>{\n                        return {...s, rules:JSON.parse(s.rules)};\n                    });\n                    this.segments = segments;\n                }\n               Promise.all(this.segments.map((segment)=>{\n                  return engine(userTraits, segment.rules)\n                      .then((res)=>{\n                          userSegments[segment.name] = res.result;\n                      })\n               }))\n                   .then(()=>{\n                       this.userSegments = userSegments;\n                       if (!disableCache) {\n                           AsyncStorage.setItem(BULLET_TRAIN_KEY, JSON.stringify(this.flags))\n                       }\n                       onChange && onChange(this.oldFlags, { isFromServer: true });\n                   })\n            } else {\n                if (!disableCache) {\n                    AsyncStorage.setItem(BULLET_TRAIN_KEY, JSON.stringify(this.flags))\n                }\n                onChange && onChange(this.oldFlags, { isFromServer: true });\n            }\n        };\n\n        if (identity) {\n            return Promise.all([\n                this.getJSON(api + 'identities/' + identity + '/'),\n                this.segments? Promise.resolve(this.segments):this.getJSON(api + 'segments/'),\n            ])\n                .then((res) => {\n                    handleResponse(res[0],res[1])\n                }).catch(({ message }) => {\n                    onError && onError({ message })\n                });\n        } else {\n            return Promise.all([\n                this.getJSON(api + \"flags/\")\n            ])\n                .then((res) => {\n                    handleResponse({flags: res[0]},null)\n                }).catch(({ message }) => {\n                    onError && onError({ message })\n                });\n        }\n    };\n\n    init({\n             environmentID,\n             api = 'https://api.bullet-train.io/api/v1/',\n             onChange,\n             disableCache,\n             onError,\n             defaultFlags\n         }) {\n\n        this.environmentID = environmentID;\n        this.api = api;\n        this.interval = null;\n        this.disableCache = disableCache;\n        this.onChange = onChange;\n        this.onError = onError;\n        this.flags = Object.assign({}, defaultFlags) || {};\n        this.initialised = true;\n\n        if (!environmentID) {\n            throw('Please specify a environment id');\n        }\n        if (!onChange) {\n            throw('Please specify an onChange event');\n        }\n\n        //If the user specified default flags emit a changed event immediately\n\n        if (!disableCache) {\n            AsyncStorage.getItem(BULLET_TRAIN_KEY, (err, res) => {\n                this.flags = res ? JSON.parse(res) : defaultFlags;\n                if (this.flags) {\n                    onChange(null, { isFromServer: false });\n                }\n                this.getFlags();\n            });\n        }\n    }\n\n    getAllFlags() {\n        return this.flags;\n    }\n\n    identify(userId) {\n        this.identity = userId;\n        if (this.initialised && !this.interval)\n            this.getFlags();\n    }\n\n    logout() {\n        this.identity = null;\n        if (this.initialised && !this.interval)\n            this.getFlags();\n    }\n\n    startListening(ticks = 1000) {\n        if (this.interval) {\n            return;\n        }\n        this.interval = setInterval(this.getFlags, ticks);\n    }\n\n    stopListening() {\n        clearInterval(this.interval);\n    }\n\n    getValue = (key) => {\n        const flag = this.flags && this.flags[key];\n        let res = null;\n        if (flag) {\n            res = flag.value;\n        }\n        //todo record check for value\n\n        return res;\n    }\n\n    getTrait = (key) => {\n        const trait = this.traits && this.traits[key];\n        return trait;\n    }\n\n    getSegments = () => {\n        return this.userSegments;\n    }\n\n    setTrait = (key, trait_value) => {\n        const { getJSON, identity, api } = this;\n\n        return getJSON(`${api}identities/${identity}/traits/${encodeURIComponent(key)}`, 'POST', JSON.stringify({ trait_value }))\n            .then(this.getFlags)\n    };\n\n    hasFeature = (key) => {\n        const flag = this.flags && this.flags[key];\n        let res = false;\n        if (flag && flag.enabled) {\n            res = true;\n        }\n        //todo record check for feature\n\n        return res;\n    }\n\n};\n\nmodule.exports = function ({ fetch, AsyncStorage }) {\n    return new BulletTrain({ fetch, AsyncStorage });\n};\n\n\n","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","import {AsyncStorage} from 'react-native';\nconst bt = require('./bullet-train-core');\nmodule.exports = bt({AsyncStorage, fetch: window.fetch});"],"sourceRoot":""}