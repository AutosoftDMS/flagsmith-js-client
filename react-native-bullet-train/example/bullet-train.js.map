{"version":3,"sources":["webpack://bullet-train/webpack/universalModuleDefinition","webpack://bullet-train/webpack/bootstrap","webpack://bullet-train/./bullet-train-core.js","webpack://bullet-train/./index.react-native.js","webpack://bullet-train/./node_modules/bullet-train-rules-engine/lib/index.js","webpack://bullet-train/external \"react-native\""],"names":["fetch","AsyncStorage","BULLET_TRAIN_KEY","BulletTrain","props","getJSON","url","method","body","environmentID","options","headers","then","res","json","getFlags","onChange","onError","identity","api","disableCache","handleResponse","segments","features","flags","traits","userTraits","userSegments","forEach","feature","name","toLowerCase","replace","enabled","value","feature_state_value","trait","trait_key","trait_value","oldFlags","map","s","rules","JSON","parse","Promise","all","segment","result","setItem","stringify","isFromServer","resolve","catch","message","getValue","key","flag","getTrait","getSegments","id","setTrait","encodeURIComponent","hasFeature","defaultFlags","interval","Object","assign","initialised","getItem","err","userId","ticks","setInterval","clearInterval","module","exports","bt","require","window"],"mappings":"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","file":"bullet-train.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"react-native\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"react-native\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"bullet-train\"] = factory(require(\"react-native\"));\n\telse\n\t\troot[\"bullet-train\"] = factory(root[\"react-native\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE_react_native__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./index.react-native.js\");\n","import engine from 'bullet-train-rules-engine';\n\nlet fetch;\nlet AsyncStorage;\nconst BULLET_TRAIN_KEY = \"BULLET_TRAIN_DB\";\n\nconst BulletTrain = class {\n\n    constructor(props) {\n        fetch = props.fetch;\n        AsyncStorage = props.AsyncStorage;\n    }\n\n    getJSON = (url, method, body) => {\n        const { environmentID } = this;\n        const options = {\n            method: method || 'GET',\n            body,\n            headers: {\n                'x-environment-key': environmentID\n            }\n        };\n        if (method !== \"GET\")\n            options.headers['Content-Type'] = 'application/json; charset=utf-8'\n\n        return fetch(url + '?format=json', options)\n            .then(res => res.json());\n    };\n\n    getFlags = () => {\n        const { onChange, onError, identity, api, disableCache } = this;\n\n        const handleResponse = ({ flags: features, traits }, segments) => {\n            // Handle server response\n            let flags = {};\n            let userTraits = {};\n            let userSegments = {};\n            features = features||[];\n            traits = traits||[];\n            features.forEach(feature => {\n                flags[feature.feature.name.toLowerCase().replace(/ /g, '_')] = {\n                    enabled: feature.enabled,\n                    value: feature.feature_state_value\n                };\n            });\n            traits.forEach(trait => {\n                userTraits[trait.trait_key.toLowerCase().replace(/ /g, '_')] = trait.trait_value\n            });\n            this.oldFlags = flags;\n            this.flags = flags;\n            this.traits = userTraits;\n            if (segments) {\n                if (!this.segments) {\n                    segments = segments.map((s)=>{\n                        return {...s, rules:JSON.parse(s.rules)};\n                    });\n                    this.segments = segments;\n                }\n               Promise.all(this.segments.map((segment)=>{\n                  return engine(userTraits, segment.rules)\n                      .then((res)=>{\n                          userSegments[segment.name] = res.result;\n                      })\n               }))\n                   .then(()=>{\n                       this.userSegments = userSegments;\n                       if (!disableCache) {\n                           AsyncStorage.setItem(BULLET_TRAIN_KEY, JSON.stringify(this.flags))\n                       }\n                       onChange && onChange(this.oldFlags, { isFromServer: true });\n                   })\n            } else {\n                if (!disableCache) {\n                    AsyncStorage.setItem(BULLET_TRAIN_KEY, JSON.stringify(this.flags))\n                }\n                onChange && onChange(this.oldFlags, { isFromServer: true });\n            }\n        };\n\n        if (identity) {\n            return Promise.all([\n                this.getJSON(api + 'identities/' + identity + '/'),\n                this.segments? Promise.resolve(this.segments):this.getJSON(api + 'segments/'),\n            ])\n                .then((res) => {\n                    handleResponse(res[0],res[1])\n                }).catch(({ message }) => {\n                    onError && onError({ message })\n                });\n        } else {\n            return Promise.all([\n                this.getJSON(api + \"flags/\")\n            ])\n                .then((res) => {\n                    handleResponse({flags: res[0]},null)\n                }).catch(({ message }) => {\n                    onError && onError({ message })\n                });\n        }\n    };\n\n    init({\n             environmentID,\n             api = 'https://api.bullet-train.io/api/v1/',\n             onChange,\n             disableCache,\n             onError,\n             defaultFlags\n         }) {\n\n        this.environmentID = environmentID;\n        this.api = api;\n        this.interval = null;\n        this.disableCache = disableCache;\n        this.onChange = onChange;\n        this.onError = onError;\n        this.flags = Object.assign({}, defaultFlags) || {};\n        this.initialised = true;\n\n        if (!environmentID) {\n            throw('Please specify a environment id');\n        }\n        if (!onChange) {\n            throw('Please specify an onChange event');\n        }\n\n        //If the user specified default flags emit a changed event immediately\n\n        if (!disableCache) {\n            AsyncStorage.getItem(BULLET_TRAIN_KEY, (err, res) => {\n                this.flags = res ? JSON.parse(res) : defaultFlags;\n                if (this.flags) {\n                    onChange(null, { isFromServer: false });\n                }\n                this.getFlags();\n            });\n        }\n    }\n\n    getAllFlags() {\n        return this.flags;\n    }\n\n    identify(userId) {\n        this.identity = userId;\n        if (this.initialised && !this.interval)\n            this.getFlags();\n    }\n\n    logout() {\n        this.identity = null;\n        if (this.initialised && !this.interval)\n            this.getFlags();\n    }\n\n    startListening(ticks = 1000) {\n        if (this.interval) {\n            return;\n        }\n        this.interval = setInterval(this.getFlags, ticks);\n    }\n\n    stopListening() {\n        clearInterval(this.interval);\n    }\n\n    getValue = (key) => {\n        const flag = this.flags && this.flags[key];\n        let res = null;\n        if (flag) {\n            res = flag.value;\n        }\n        //todo record check for value\n\n        return res;\n    }\n\n    getTrait = (key) => {\n        const trait = this.traits && this.traits[key];\n        return trait;\n    }\n\n    getSegments = () => {\n        return this.userSegments;\n    }\n\n    segment = (id) => {\n        return this.userSegments && this.userSegments[id];\n    }\n\n    setTrait = (key, trait_value) => {\n        const { getJSON, identity, api } = this;\n\n        return getJSON(`${api}identities/${identity}/traits/${encodeURIComponent(key)}`, 'POST', JSON.stringify({ trait_value }))\n            .then(this.getFlags)\n    };\n\n    hasFeature = (key) => {\n        const flag = this.flags && this.flags[key];\n        let res = false;\n        if (flag && flag.enabled) {\n            res = true;\n        }\n        //todo record check for feature\n\n        return res;\n    }\n\n};\n\nmodule.exports = function ({ fetch, AsyncStorage }) {\n    return new BulletTrain({ fetch, AsyncStorage });\n};\n\n\n","import {AsyncStorage} from 'react-native';\nconst bt = require('./bullet-train-core');\nmodule.exports = bt({AsyncStorage, fetch: window.fetch});","!function(e,n){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=n():\"function\"==typeof define&&define.amd?define([],n):\"object\"==typeof exports?exports[\"bullet-train-rules-engine\"]=n():e[\"bullet-train-rules-engine\"]=n()}(window,function(){return function(e){var n={};function r(t){if(n[t])return n[t].exports;var u=n[t]={i:t,l:!1,exports:{}};return e[t].call(u.exports,u,u.exports,r),u.l=!0,u.exports}return r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&\"object\"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,\"default\",{enumerable:!0,value:e}),2&n&&\"string\"!=typeof e)for(var u in e)r.d(t,u,function(n){return e[n]}.bind(null,u));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,\"a\",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p=\"\",r(r.s=1)}([function(e,n,r){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0}),n.default=function e(n,r,t){r=Array.isArray(r)?r:r.split(\".\");n=n[r[0]];if(n&&r.length>1)return e(n,r.slice(1));return void 0===n?t:n}},function(e,n,r){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0}),n.default=function(e,n){return y(e,{all:{rules:n}},[\"all\"]).then(function(e){return{result:e.all.result,rules:e.all.rules}})};var t=function(e){return e&&e.__esModule?e:{default:e}}(r(0));var u=function(e){0},o=\"EQUAL\",l=\"NOT_EQUAL\",a=\"GREATER_THAN\",c=\"GREATER_THAN_INCLUSIVE\",i=\"LESS_THAN\",f=\"LESS_THAN_INCLUSIVE\",s=\"CONTAINS\",d=\"NOT_CONTAINS\",p=\"REGEX\",y=function e(n,r,y){return u(0),new Promise(function(v,b){var _=y[y.length-1],E=(0,t.default)(r,y);if(\"all\"===_||\"any\"===_||\"none\"===_)return Promise.all(E.rules.map(function(t,u){var o=[\"rules\",u];return t.any?o=o.concat([\"any\"]):t.all?o=o.concat([\"all\"]):t.none&&(o=o.concat([\"none\"])),e(n,r,y.concat(o))})).then(function(e){var n=void 0;return\"all\"===_?n=!e.includes(!1):\"any\"===_?n=e.includes(!0):\"none\"===_&&(n=!e.includes(!0)),E.result=!!n,1===y.length&&v(r),v(n)});var O=!!function(e,n){var r=n.property,y=n.operator,v=n.value;u();var b=(0,t.default)(e,r);switch(y){case o:return b===v;case l:return b!==v;case a:return b>v;case c:return b>=v;case i:return b<v;case f:return b<=v;case s:return b&&(b+\"\").includes(v);case d:return!b||!(b+\"\").includes(v);case p:return b&&new RegExp(v).test(b);default:return console.error(\"Invalid operator\"),!1}}(n,E);return E.result=O,v(O)})}}])});\n//# sourceMappingURL=index.js.map","module.exports = __WEBPACK_EXTERNAL_MODULE_react_native__;"],"sourceRoot":""}