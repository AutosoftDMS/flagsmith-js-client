!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react-native")):"function"==typeof define&&define.amd?define(["react-native"],t):"object"==typeof exports?exports["bullet-train"]=t(require("react-native")):e["bullet-train"]=t(e["react-native"])}(window,function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,n,r){return n=Array.isArray(n)?n:n.split("."),(t=t[n[0]])&&n.length>1?e(t,n.slice(1)):void 0===t?r:t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return i(e,{all:{rules:t}},["all"]).then(function(e){return{result:e.all.result,rules:e.all.rules}})};var r=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),i=function e(t,n,i){return new Promise(function(a,o){var u=i[i.length-1],s=(0,r.default)(n,i);if("all"===u||"any"===u||"none"===u)return Promise.all(s.rules.map(function(r,a){var o=["rules",a];return r.any?o=o.concat(["any"]):r.all?o=o.concat(["all"]):r.none&&(o=o.concat(["none"])),e(t,n,i.concat(o))})).then(function(e){var t=void 0;return"all"===u?t=!e.includes(!1):"any"===u?t=e.includes(!0):"none"===u&&(t=!e.includes(!0)),s.result=!!t,1===i.length&&a(n),a(t)});var l=!!function(e,t){var n=t.property,i=t.operator,a=t.value,o=(0,r.default)(e,n);switch(i){case"EQUAL":return o===a;case"NOT_EQUAL":return o!==a;case"GREATER_THAN":return o>a;case"GREATER_THAN_INCLUSIVE":return o>=a;case"LESS_THAN":return o<a;case"LESS_THAN_INCLUSIVE":return o<=a;case"CONTAINS":return o&&(o+"").includes(a);case"NOT_CONTAINS":return!o||!(o+"").includes(a);case"REGEX":return o&&new RegExp(a).test(o);default:return console.error("Invalid operator"),!1}}(t,s);return s.result=l,a(l)})}}])},function(e,t,n){"use strict";var r,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),u=(r=o)&&r.__esModule?r:{default:r};var s=void 0,l=void 0,c="BULLET_TRAIN_DB",f=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.getJSON=function(e,t,r){var i=n.environmentID,a={method:t||"GET",body:r,headers:{"x-environment-key":i}};return"GET"!==t&&(a.headers["Content-Type"]="application/json; charset=utf-8"),s(e,a).then(function(e){return e.json()})},this.getFlags=function(){var e=n.onChange,t=n.onError,r=n.identity,a=n.api,o=n.disableCache,s=function(t,r){var a=t.flags,s=t.traits,f={},d={},g={};a=a||[],s=s||[],a.forEach(function(e){f[e.feature.name.toLowerCase().replace(/ /g,"_")]={enabled:e.enabled,value:e.feature_state_value}}),s.forEach(function(e){d[e.trait_key.toLowerCase().replace(/ /g,"_")]=e.trait_value}),n.oldFlags=f,n.flags=f,n.traits=d,r?(n.segments||(r=r.map(function(e){return i({},e,{rules:JSON.parse(e.rules)})}),n.segments=r),Promise.all(n.segments.map(function(e){return(0,u.default)(d,e.rules).then(function(t){g[e.name]=t.result})})).then(function(){n.userSegments=g,o||l.setItem(c,JSON.stringify(n.flags)),e&&e(n.oldFlags,{isFromServer:!0})})):(o||l.setItem(c,JSON.stringify(n.flags)),e&&e(n.oldFlags,{isFromServer:!0}))};return r?Promise.all([n.getJSON(a+"identities/?identifier="+encodeURIComponent(r)),n.segments?Promise.resolve(n.segments):n.getJSON(a+"segments/")]).then(function(e){s(e[0],e[1])}).catch(function(e){var n=e.message;t&&t({message:n})}):Promise.all([n.getJSON(a+"flags/")]).then(function(e){s({flags:e[0]},null)}).catch(function(e){var n=e.message;t&&t({message:n})})},this.getValue=function(e){var t=n.flags&&n.flags[e],r=null;return t&&(r=t.value),r},this.getTrait=function(e){return n.traits&&n.traits[e]},this.getSegments=function(){return n.userSegments},this.segment=function(e){return n.userSegments&&n.userSegments[e]},this.setTrait=function(e,t){var r=n.getJSON,i={identity:{identifier:n.identity},trait_key:e,trait_value:t};return r(n.api+"traits/","POST",JSON.stringify(i)).then(n.getFlags)},this.hasFeature=function(e){var t=n.flags&&n.flags[e],r=!1;return t&&t.enabled&&(r=!0),r},s=t.fetch,l=t.AsyncStorage}return a(e,[{key:"init",value:function(e){var t=this,n=e.environmentID,r=e.api,i=void 0===r?"https://api.bullet-train.io/api/v1/":r,a=e.onChange,o=e.disableCache,u=e.onError,s=e.defaultFlags;if(this.environmentID=n,this.api=i,this.interval=null,this.disableCache=o,this.onChange=a,this.onError=u,this.flags=Object.assign({},s)||{},this.initialised=!0,!n)throw"Please specify a environment id";if(!a)throw"Please specify an onChange event";o||l.getItem(c,function(e,n){t.flags=n?JSON.parse(n):s,t.flags&&a(null,{isFromServer:!1}),t.getFlags()})}},{key:"getAllFlags",value:function(){return this.flags}},{key:"identify",value:function(e){this.identity=e,this.initialised&&!this.interval&&this.getFlags()}},{key:"logout",value:function(){this.identity=null,this.initialised&&!this.interval&&this.getFlags()}},{key:"startListening",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;this.interval||(this.interval=setInterval(this.getFlags,e))}},{key:"stopListening",value:function(){clearInterval(this.interval)}}]),e}();e.exports=function(e){var t=e.fetch,n=e.AsyncStorage;return new f({fetch:t,AsyncStorage:n})}},function(t,n){t.exports=e},function(e,t,n){"use strict";var r=n(2),i=n(1);e.exports=i({AsyncStorage:r.AsyncStorage,fetch:window.fetch})}])});
//# sourceMappingURL=bullet-train.js.map